# When using dind, it's wise to use the overlayfs driver for
# improved performance.
variables:
  DOCKER_DRIVER: overlay
  GCP_PROJECT_ID: cicd-testing-273606
  IMAGE_NAME: hack-tom/cicd-testing-273606:v1.0

services:
- docker:apline:3.11.5

stages:
  - test
  - publish

tests:
  image: python:3.7
  stage: test
  script:
    - python test.py
  tags:
    - docker

before_script:
  - docker info

publish-image:
  stage: publish
  script:
    - docker build -t my-docker-image .
  only:
    master